**Raw**

```java
@RestController
@RequestMapping("file")
public class FileController {

    private static final SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
    
    @Autowired
    private MyFile myFile;

    @Autowired
    IFileService fileService;

    @PostMapping("upload")
    /**
     *	ResultInfo实体类封装信息
     */
    ResultInfo<MyFile> upload(MultipartFile multipartFile) throws FileNotFoundException {
        String date = sdf.format(new Date());
        String size = String.format("%.3f", multipartFile.getSize() / (1024 * 1024.0)) + "MB";
        String oldName = multipartFile.getOriginalFilename();
        String suffix = FilenameUtils.getExtension(oldName);
        String folder = ResourceUtils.getURL("classpath:").getPath() + "static/files/";
        File file = new File(folder, date);

        if (!file.exists()) {
            file.mkdirs();	//根据日期创建文件夹
        }
//        新文件名
        String newName = date.replace("-", "") + UUID.randomUUID().toString().replace("-", "") + "." + suffix;
        try {
            // 上传文件到服务器的指定路径
            multipartFile.transferTo(new File(file, newName));
            myFile.setUserId("1")
                	.setUploadTime(new Date()).setSize(size)
                    .setType(multipartFile.getContentType())
                    .setSuffix(suffix)
                	.setPath("/files/" + date + "/")
                    .setOldName(oldName)
                	.setNewName(newName)
                    .setDescription("第一条记录").setDownloadCount(0);

            //  修改或者插入
            fileService.save(myFile);
            System.out.println("上传文件成功");
            //  返回前端数据
            return new ResultInfo<>(true, "上传文件成功", myFile);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return new ResultInfo<>(false, "上传文件失败", myFile);
    }
}


// 下载
/**
     * @param newName  服务器当中的文件名称,文件名规则 Date+UUID+suffix
     * @param response
     */
    @GetMapping("download")
    public void download(MyFile myFile,
                         HttpServletResponse response,
                         HttpSession session) throws Exception {
        System.out.println("myFile = " + myFile);
        String newName = myFile.getNewName();
        String folder = ResourceUtils.getURL("classpath:").getPath() + "static/" + myFile.getPath();
        System.out.println("folder = " + folder);

        // 文件回响类型
        response.setContentType(session.getServletContext().getMimeType(newName));
        // 弹出下载
        response.setHeader("content-disposition", "attachment;filename=" + newName);

        File file = new File(folder, newName);

        FileInputStream fis = new FileInputStream(file);
        ServletOutputStream sos = response.getOutputStream();
		// 将文件从 fis 拷贝到 sos是流中 
        IOUtils.copy(fis, sos);
        fis.close();
        sos.close();
    }
```





**Hutool**

```java
@RestController
@RequestMapping("file")
public class FileController {

    @PostMapping("upload")
    public String upload(MultipartFile file) {
        String oldName = file.getOriginalFilename();
        // 获取当前项目的绝对路径
        String rootDir = System.getProperty("user.dir") + "/springboot/src/main/resources/files/" + oldName;
        System.out.println("rootDir = " + rootDir);
        try {
            FileUtil.writeBytes(file.getBytes(), rootDir);
        } catch (IOException e) {
            e.printStackTrace();
        }

        return rootDir;
    }

    @GetMapping("download/{flag}")
    public void download(HttpServletRequest request, HttpServletResponse response, @PathVariable String flag) throws IOException {
        ServletOutputStream outputStream = null;
        String rootDir = System.getProperty("user.dir") + "/springboot/src/main/resources/files/";
        List<String> fileNames = FileUtil.listFileNames(rootDir);
        String filename = fileNames.stream().filter(name -> name.contains(flag)).findAny().orElse("");
        try {
            if (BeanUtil.isNotEmpty(filename)) {
                response.setHeader("Content-Disposition", "attachment;filename=" + URLEncoder.encode(filename, CharsetUtil.UTF_8));
                String mimeType = request.getServletContext().getMimeType(filename);
                System.out.println("mimeType = " + mimeType);
                response.setContentType(mimeType);
                byte[] bytes = FileUtil.readBytes(rootDir + filename);
                outputStream = response.getOutputStream();
                outputStream.write(bytes);
                outputStream.flush();
            }
        } catch (Exception e) {
            System.out.println("文件下载失败");
        } finally {
            outputStream.close();
        }
    }
}

```